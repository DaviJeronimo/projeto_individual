<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type One | Registro</title>


    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/estilo.css" />

    <script src="../js/sessao.js"></script>
    <script src="../js/alerta.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body onload="validarSessao()">
   <div class="janela">

        <div class="header-left">

            <img class="imagemdash" src="../assets/imgs/logocomfrase.png" alt="typeonelogo">

            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>

            <div class="btn-nav">
                <h3>Registrar</h3>
            </div>

             <div class="btn-nav">
                <a href="./indicador.html">
                    <h3>Indicadores</h3>
                </a>

            </div>

            <div class="btn-nav-white">
                <a href="./dashboard.html">
                     <h3>Gráficos</h3>
                </a>
            </div>

            <div class="btn-nav-white">
                <a href="./mural.html">
                    <h3 style="display: flex;justify-content: center;">InsulCalc</h3>
                </a>
            </div>
            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>
        </div>
    </div>

    
    <div class="registro">
        <div class="position">
            <h1 style="color: #32b9cd; margin-left: 22%;margin-bottom: 5%;font-size: 300%;">Registrar Glicemia</h1>
            <span id="slogan" style="color: white;font-size: 150%;text-align: center; margin-left: 12%;">Seja bem-vindo ao nosso registrador de glicemia, insira os dados solicitados:</span> <br>
            <span style="color: white;margin-left: 45%;">Valor glicêmico atual:</span>

            <input class="camposregistro" style=" margin-left: 42%; width: 30%;" type="number" placeholder="Valor(mg/dl)" id="ipt_valor">

           <span style="color: white;margin-left: 47%;">horário da medição:</span> 

            <input class="camposregistro" style="width: 9%;margin-left: 52%;" type="time" id="ipt_horario">

            <span style="color: white;margin-left: 31%;">Selecione o dia que está fazendo a medição:</span>

            <select class="camposregistro" style=" margin-left: 51%;  width: 15%;" id="selectdia">
                <option value="#">...</option>
                <option value="domingo">Domingo</option>
                <option value="segunda">Segunda</option>
                <option value="terca">Terça</option>
                <option value="quarta">Quarta</option>
                <option value="quinta">Quinta</option>
                <option value="sexta">Sexta</option>
                <option value="sabado">Sábado</option>
            </select>
            <button style="margin-left: 39%;margin-top: 2%;" class="buttons" onclick="registrar()">Registrar</button>
        </div>
    </div>

</body>

<script>
    function registrar() {
        var valor = Number(ipt_valor.value);
        var horario = ipt_horario.value;
        var diaDaSemana = selectdia.value;
        var idusuario = sessionStorage.ID_USUARIO;

        if (valor == '' || valor <= 0 || horario == "" || diaDaSemana == '#')  {
            alert('Preencha todos os campos corretamente!')
            return;
        }
        if (valor > 400) {
            alert("Cuidado, sua glicemia está muito alta!");
        }
        else if (valor < 70) {
            alert("Cuidado, sua glicemia está muito baixa!");
        }
    
    var nivel = '';
    if (valor < 70) {
        nivel = 'Baixa';
    }
    else if (valor <= 140) {
        nivel = 'Ideal';
    }
    else{
        nivel = 'Alta';
    }

    fetch("/glicemia/registrar",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
            valorServer: valor,
            horarioServer: horario,
            diaServer: diaDaSemana,
            nivelServer: nivel,
            usuarioServer: idusuario  
    })
})

.then(function(resposta) {
    if (resposta.ok) {
        alert('Glicemia registrada com sucesso!')
        ipt_valor.value = '';
        ipt_horario.value = '';
        selectdia.value = '#';
    }else{
        alert("Erro ao registrar.")
    }
})
.catch(function(erro) {
    console.error('Erro fetch:', erro);
    alert("Erro ao registrar (ver console).")
});
}

</script>

</html>